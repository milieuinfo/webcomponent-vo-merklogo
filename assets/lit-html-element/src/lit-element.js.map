{"version":3,"file":"lit-element.js","sourceRoot":"","sources":["../../src/lit-element.ts"],"names":[],"mappings":"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","sourcesContent":["import { html, render } from '../node_modules/lit-html/lib/lit-extended.js';\nimport { TemplateResult } from '../node_modules/lit-html/lit-html.js';\n\nexport { html } from '../node_modules/lit-html/lib/lit-extended.js';\nexport { TemplateResult } from '../node_modules/lit-html/lit-html.js';\n\nexport interface PropertyOptions {\n  type?: BooleanConstructor | DateConstructor | NumberConstructor | StringConstructor|\n  ArrayConstructor | ObjectConstructor;\n  value?: any;\n  attrName?: string;\n  computed?: string;\n}\n\nexport interface ListenerOptions {\n  target: string | EventTarget,\n  eventName: string,\n  handler: Function\n}\n\nexport interface Map<T> {\n  [key: string]: T;\n}\n\nexport function createProperty(prototype: any, propertyName: string, options: PropertyOptions = {}): void {\n  if (!prototype.constructor.hasOwnProperty('properties')) {\n    Object.defineProperty(prototype.constructor, 'properties', { value: {} });\n  }\n  prototype.constructor.properties[propertyName] = options;\n  // Cannot attach from the decorator, won't override property.\n  Promise.resolve().then(() => attachProperty(prototype, propertyName, options));\n}\n\nfunction attachProperty(prototype: any, propertyName: string, options: PropertyOptions) {\n  const { type: typeFn, attrName } = options;\n\n  function get(this: LitElement) { return this.__values__[propertyName]; }\n  function set(this: LitElement, v: any) {\n    // @ts-ignore\n    let value = (v === null || v === undefined) ? v : (typeFn === Array ? v : typeFn(v));\n    this._setPropertyValue(propertyName, value);\n    if (attrName) {\n      this._setAttributeValue(attrName, value, typeFn);\n    }\n    this.invalidate();\n  }\n\n  Object.defineProperty(prototype, propertyName, options.computed ? {get} : {get, set});\n}\n\nexport function whenAllDefined(result: TemplateResult) {\n  const template = result.template;\n  const rootNode = template.element.content;\n  const walker = document.createTreeWalker(rootNode, NodeFilter.SHOW_ELEMENT, null as any, false);\n\n  const deps = new Set();\n  while (walker.nextNode()) {\n    const element = walker.currentNode as Element;\n    if (element.tagName.includes('-')) {\n      deps.add(element.tagName.toLowerCase());\n    }\n  }\n\n  return Promise.all(Array.from(deps).map(tagName => customElements.whenDefined(tagName)));\n}\n\nexport class LitElement extends HTMLElement {\n  private _needsRender: boolean = false;\n  private _lookupCache: Map<HTMLElement> = {};\n  private _attrMap: Map<string> = {};\n  private _deps: Map<Array<Function>> = {};\n  __values__: Map<any> = {};\n\n  _setPropertyValue(propertyName: string, newValue: any) {\n    this.__values__[propertyName] = newValue;\n    if (this._deps[propertyName]) {\n      this._deps[propertyName].map((fn: Function) => fn());\n    }\n  }\n\n  _setPropertyValueFromAttributeValue(attrName: string, newValue: any) {\n    const propertyName = this._attrMap[attrName];\n    const { type: typeFn } = (this.constructor as any).properties[propertyName];\n\n    let value;\n    if (typeFn.name === 'Boolean') {\n      value = (newValue === '') || (!!newValue && newValue === attrName.toLowerCase());\n    } else {\n      value = (newValue !== null) ? typeFn(newValue) : undefined;\n    }\n    this._setPropertyValue(propertyName, value);\n  }\n\n  _setAttributeValue(attrName: string, value: any, typeFn: any) {\n    // @ts-ignore\n    if (typeFn.name === 'Boolean') {\n      if (!value) {\n        this.removeAttribute(attrName);\n      } else {\n        this.setAttribute(attrName, '');\n      }\n    } else {\n      this.setAttribute(attrName, value);\n    }\n  }\n\n  static get properties(): Map<PropertyOptions> {\n    return {};\n  }\n\n  static get listeners(): Array<ListenerOptions> {\n    return [];\n  }\n\n  static get observedAttributes(): string[] {\n    return Object.keys(this.properties)\n      .map(key => (<any>this.properties)[key].attrName)\n      .filter(name => name);\n  }\n\n  constructor() {\n    super();\n    this.attachShadow({ mode: 'open' });\n\n    for (const propertyName in (this.constructor as any).properties) {\n      const options = (this.constructor as any).properties[propertyName];\n      const { value, attrName, computed } = options;\n\n      // We can only handle properly defined attributes.\n      if (typeof(attrName) === 'string' && attrName.length) {\n        this._attrMap[attrName] = propertyName;\n      }\n      // Properties backed by attributes have default values set from attributes, not 'value'.\n      if (!attrName && value !== undefined) {\n        this._setPropertyValue(propertyName, value);\n      }\n\n      const match = /(\\w+)\\((.+)\\)/.exec(computed);\n      if (match) {\n        const fnName = match[1];\n        const targets = match[2].split(/,\\s*/);\n\n        const computeFn = () => {\n          const values = targets.map(target => (<any>this)[target]);\n          if ((<any>this)[fnName] && values.every(entry => entry !== undefined)) {\n            const computedValue = (<any>this)[fnName].apply(this, values);\n            this._setPropertyValue(propertyName, computedValue);\n          }\n        };\n\n        for (const target of targets) {\n          if (!this._deps[target]) {\n            this._deps[target] = [ computeFn ];\n          } else {\n            this._deps[target].push(computeFn);\n          }\n        }\n        computeFn();\n      }\n    }\n  }\n\n  static withProperties() {\n    for (const propertyName in this.properties) {\n      attachProperty(this.prototype, propertyName, this.properties[propertyName]);\n    }\n    return this;\n  }\n\n  renderCallback() {\n    render(this.render(this), this.shadowRoot as ShadowRoot);\n  }\n\n  // @ts-ignore\n  render(self: any): TemplateResult {\n    return html``;\n  }\n\n  attributeChangedCallback(attrName: string, _oldValue: string, newValue: string) {\n    this._setPropertyValueFromAttributeValue(attrName, newValue);\n    this.invalidate();\n  }\n\n  connectedCallback() {\n    for (const attrName of (this.constructor as any).observedAttributes) {\n      this._setPropertyValueFromAttributeValue(attrName, this.getAttribute(attrName));\n    }\n\n    this.invalidate().then(() => {\n      for (const listener of (this.constructor as any).listeners as Array<ListenerOptions>) {\n        const target = typeof listener.target === 'string' ? this.$(listener.target) : listener.target;\n        target.addEventListener(listener.eventName, listener.handler.bind(this));\n      }\n    });\n  }\n\n  async invalidate() {\n    if (!this._needsRender) {\n      this._needsRender = true;\n      // Schedule the following as micro task, which runs before\n      // requestAnimationFrame. All additional invalidate() calls\n      // before will be ignored.\n      // https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/\n      this._needsRender = await false;\n      this.renderCallback();\n    }\n  }\n\n  $(id: string) {\n    let value = this._lookupCache[id];\n    if (!value && this.shadowRoot) {\n      const element = this.shadowRoot.getElementById(id);\n      if (element) {\n        value = element;\n        this._lookupCache[id] = element;\n      }\n    }\n    return value;\n  }\n}"]}